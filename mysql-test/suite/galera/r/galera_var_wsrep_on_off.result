call mtr.add_suppression("Cannot modify @@session.wsrep_on");
CREATE TABLE t1 (f1 INTEGER PRIMARY KEY) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1);
SET SESSION wsrep_on = FALSE;
INSERT INTO t1 VALUES (2);
SELECT COUNT(*) = 1 FROM t1;
COUNT(*) = 1
1
SET SESSION wsrep_on = TRUE;
INSERT INTO t1 VALUES (3);
SELECT COUNT(*) = 2 FROM t1;
COUNT(*) = 2
1
SELECT COUNT(*) = 0 FROM t1 WHERE f1 = 2;
COUNT(*) = 0
1
SELECT COUNT(*) = 1 FROM t1 WHERE f1 = 3;
COUNT(*) = 1
1
DROP TABLE t1;
#node-1
set session wsrep_on = TRUE;
create table t1 (i int) engine=innodb;
insert into t1 values (1), (2);
#node-2
select * from t1;
i
1
2
#node-1
set session wsrep_on = TRUE;
begin;
insert into t1 values (3), (4);
commit;
#node-2
select * from t1;
i
1
2
3
4
#node-1
set session wsrep_on = TRUE;
begin;
insert into t1 values (5), (6);
set session wsrep_on = FALSE;
ERROR 42000: Variable 'wsrep_on' can't be set to the value of 'OFF'
select * from t1;
i
1
2
3
4
5
6
commit;
#node-2
select * from t1;
i
1
2
3
4
5
6
#node-1
set session wsrep_on = TRUE;
begin;
insert into t1 values (7), (8);
set session wsrep_on = FALSE;
ERROR 42000: Variable 'wsrep_on' can't be set to the value of 'OFF'
select * from t1;
i
1
2
3
4
5
6
7
8
rollback;
#node-2
select * from t1;
i
1
2
3
4
5
6
#node-1
set session wsrep_on = FALSE;
begin;
insert into t1 values (9), (10);
set session wsrep_on = TRUE;
ERROR 42000: Variable 'wsrep_on' can't be set to the value of 'ON'
commit;
select * from t1;
i
1
2
3
4
5
6
9
10
insert into t1 values (11), (12);
#node-2
select * from t1;
i
1
2
3
4
5
6
#node-1
set session wsrep_on = TRUE;
drop table t1;
#node-1
SET SESSION wsrep_on=OFF;
RESET MASTER;
SET SESSION wsrep_on=ON;
#node-2
SET SESSION wsrep_on=OFF;
RESET MASTER;
SET SESSION wsrep_on=ON;
#node-1
create table t (i int, primary key pk(i)) engine=innodb;
insert into t values (1);
set session wsrep_on = OFF;
insert into t values (2);
set session wsrep_on = ON;
insert into t values (3);
drop table t;
SHOW BINLOG EVENTS IN 'mysqld-bin.000001' FROM 124;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
mysqld-bin.000001	124	Previous_gtids	1	155	
mysqld-bin.000001	155	Anonymous_Gtid	1	232	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	232	Query	1	375	use `test`; create table t (i int, primary key pk(i)) engine=innodb /* xid=# */
mysqld-bin.000001	375	Anonymous_Gtid	1	454	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	454	Query	1	534	BEGIN
mysqld-bin.000001	534	Table_map	1	581	table_id: # (test.t)
mysqld-bin.000001	581	Write_rows	1	621	table_id: # flags: STMT_END_F
mysqld-bin.000001	621	Xid	1	652	COMMIT /* xid=# */
mysqld-bin.000001	652	Anonymous_Gtid	1	731	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	731	Query	1	811	BEGIN
mysqld-bin.000001	811	Table_map	1	858	table_id: # (test.t)
mysqld-bin.000001	858	Write_rows	1	898	table_id: # flags: STMT_END_F
mysqld-bin.000001	898	Xid	1	929	COMMIT /* xid=# */
mysqld-bin.000001	929	Anonymous_Gtid	1	1006	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1006	Query	1	1132	use `test`; DROP TABLE `t` /* generated by server */ /* xid=# */
